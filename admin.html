<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamArc Studio</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #05070a; --bg-surface: #10141d; --bg-input: #161b26;
            --brand-gradient: linear-gradient(135deg, #29abe2 0%, #9e00ff 100%);
            --brand-glow: 0 0 20px rgba(41, 171, 226, 0.2);
            --cyan: #29abe2; --text-main: #ffffff; --text-sub: #94a3b8;
            --border: rgba(255, 255, 255, 0.08); --danger: #ef4444; --success: #10b981;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; font-family: 'Outfit', sans-serif; }
        body { background-color: var(--bg-deep); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .btn { border: none; border-radius: 8px; padding: 12px 20px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s; }
        .btn-brand { background: var(--brand-gradient); color: white; box-shadow: var(--brand-glow); }
        .btn-ghost { background: transparent; border: 1px solid var(--border); color: var(--text-sub); }
        .btn-danger { background: rgba(239, 68, 68, 0.15); color: var(--danger); border: 1px solid rgba(239, 68, 68, 0.3); }
        .btn-edit { background: rgba(245, 158, 11, 0.15); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.3); }

        #auth-overlay { position: fixed; inset: 0; background: var(--bg-deep); z-index: 999; display: flex; justify-content: center; align-items: center; background-image: radial-gradient(circle at 50% 50%, rgba(41, 171, 226, 0.05) 0%, transparent 50%); }
        .login-card { background: rgba(16, 20, 29, 0.7); backdrop-filter: blur(20px); padding: 40px; width: 380px; border-radius: 20px; border: 1px solid var(--border); text-align: center; }
        
        .sidebar { width: 260px; background: var(--bg-surface); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 25px; z-index: 10; }
        .nav-item { padding: 14px 16px; color: var(--text-sub); cursor: pointer; border-radius: 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; font-weight: 500; }
        .nav-item:hover, .nav-item.active { background: rgba(41, 171, 226, 0.1); color: var(--cyan); }
        
        .main-content { flex: 1; overflow-y: auto; padding: 40px; }
        .page-header { margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .page-title { font-size: 2rem; font-weight: 700; color: white; }

        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .form-group.full { grid-column: span 2; }
        input, select, textarea { width: 100%; padding: 14px; background: var(--bg-input); border: 1px solid var(--border); color: white; border-radius: 8px; margin-top: 8px; }
        
        .cat-builder-list { height: 400px; overflow-y: auto; background: var(--bg-input); border: 1px solid var(--border); border-radius: 8px; padding: 10px; }
        .cat-item-row { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid var(--border); }
        .cat-checkbox { width: 18px; height: 18px; margin-right: 15px; accent-color: var(--cyan); }
        
        .content-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; margin-top: 10px; }
        .content-table th { text-align: left; color: var(--text-sub); padding: 15px; font-size: 0.8rem; text-transform: uppercase; }
        .content-table td { background: var(--bg-surface); padding: 15px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); }
        .content-table td:first-child { border-left: 1px solid var(--border); border-top-left-radius: 8px; border-bottom-left-radius: 8px; }
        .content-table td:last-child { border-right: 1px solid var(--border); border-top-right-radius: 8px; border-bottom-right-radius: 8px; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
        .badge.movie { background: rgba(41, 171, 226, 0.15); color: var(--cyan); }
        .badge.series { background: rgba(158, 0, 255, 0.15); color: #c084fc; }
        
        .ep-item { padding: 8px; background: rgba(255,255,255,0.05); margin-bottom: 5px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>
    <div id="auth-overlay">
        <div class="login-card">
            <h2 style="margin-bottom:20px;">StreamArc Studio</h2>
            <form onsubmit="event.preventDefault(); login();">
                <input type="text" id="u-name" placeholder="USERNAME" style="text-align:center;">
                <input type="password" id="u-pass" placeholder="PASSWORD" style="text-align:center; margin-bottom:20px;">
                <button type="submit" class="btn btn-brand" style="width:100%">INITIALIZE</button>
            </form>
            <p id="login-error" style="color:var(--danger); margin-top:20px; display:none;">ACCESS DENIED</p>
        </div>
    </div>

    <div id="dashboard-ui" class="hidden" style="width:100%; display:flex;">
        <div class="sidebar">
            <div style="font-size:1.4rem; font-weight:800; color:white; margin-bottom:40px;">StreamArc</div>
            <div class="nav-item active" onclick="switchTab('dashboard', this)"><i class="fas fa-chart-pie"></i> Dashboard</div>
            <div class="nav-item" onclick="switchTab('add-movie', this)"><i class="fas fa-film"></i> Movie Editor</div>
            <div class="nav-item" onclick="switchTab('add-series', this)"><i class="fas fa-layer-group"></i> Series Editor</div>
            <div class="nav-item" onclick="switchTab('categories', this)"><i class="fas fa-list"></i> Home Editor</div>
            <div class="nav-item" onclick="switchTab('library', this)"><i class="fas fa-database"></i> Content Library</div>
            <div class="nav-item" onclick="location.reload()" style="margin-top:auto; color:var(--danger)"><i class="fas fa-power-off"></i> Terminate</div>
        </div>

        <div class="main-content">
            <div id="view-dashboard" class="page-section fade-in">
                <div class="page-header"><div class="page-title">System Overview</div></div>
                <div style="background:var(--bg-surface); padding:30px; border-radius:16px; border:1px solid var(--border);">
                    <h1>Welcome, Admin</h1>
                    <p style="color:var(--text-sub); margin-top:10px;">Select an option from the sidebar to manage content.</p>
                </div>
            </div>

            <div id="view-add-movie" class="page-section hidden fade-in">
                <div class="page-header">
                    <div class="page-title" id="m-page-title">New Movie Asset</div>
                    <button class="btn btn-ghost" onclick="resetForms()">Reset / New</button>
                </div>
                <div class="form-grid">
                    <div class="form-group full"><label>Title</label><input type="text" id="m-title"></div>
                    <div class="form-group"><label>Year</label><input type="text" id="m-year"></div>
                    <div class="form-group"><label>Genre</label><input type="text" id="m-genre"></div>
                    <div class="form-group"><label>Poster URL</label><input type="text" id="m-poster"></div>
                    <div class="form-group"><label>Backdrop URL</label><input type="text" id="m-backdrop"></div>
                    <div class="form-group full"><label>Stream URL</label><input type="text" id="m-url"></div>
                    <div class="form-group full"><label>Synopsis</label><textarea id="m-desc" rows="4"></textarea></div>
                </div>
                <button class="btn btn-brand" id="m-submit-btn" onclick="submitContent('movie')">Publish Movie</button>
            </div>

            <div id="view-add-series" class="page-section hidden fade-in">
                <div class="page-header">
                    <div class="page-title" id="s-page-title">New Series Asset</div>
                    <button class="btn btn-ghost" onclick="resetForms()">Reset / New</button>
                </div>
                <div class="form-grid">
                    <div class="form-group full"><label>Title</label><input type="text" id="s-title"></div>
                    <div class="form-group"><label>Year</label><input type="text" id="s-year"></div>
                    <div class="form-group"><label>Genre</label><input type="text" id="s-genre"></div>
                    <div class="form-group"><label>Poster URL</label><input type="text" id="s-poster"></div>
                    <div class="form-group"><label>Backdrop URL</label><input type="text" id="s-backdrop"></div>
                    <div class="form-group full"><label>Synopsis</label><textarea id="s-desc" rows="3"></textarea></div>
                </div>
                
                <div style="padding:20px; border:1px dashed var(--border); border-radius:10px; margin-bottom:20px;">
                    <h3>Add Episode</h3>
                    <div class="form-grid" style="margin-top:10px;">
                        <input type="number" id="ep-season" placeholder="Season" value="1">
                        <input type="number" id="ep-num" placeholder="Episode" value="1">
                        <input type="text" id="ep-title" placeholder="Ep Title">
                        <input type="text" id="ep-url" placeholder="Stream URL">
                        <input type="text" id="ep-dur" placeholder="Duration (e.g. 45m)">
                        <input type="text" id="ep-thumb" placeholder="Thumbnail URL (Optional)">
                    </div>
                    <button class="btn btn-ghost" onclick="addEpisodeToList()">Add Episode to List</button>
                    <div id="ep-preview-list" style="margin-top:15px; color:var(--text-sub);"></div>
                </div>
                <button class="btn btn-brand" id="s-submit-btn" onclick="submitContent('series')">Publish Series</button>
            </div>

            <div id="view-categories" class="page-section hidden fade-in">
                <div class="page-header"><div class="page-title">Home Page Layout</div></div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:30px;">
                    <div>
                        <div style="background:var(--bg-surface); padding:20px; border-radius:10px; border:1px solid var(--border);">
                            <h3>Create / Edit Category</h3>
                            <input type="text" id="cat-name" placeholder="Category Name (e.g. Best of Ben 10)">
                            <p style="margin:15px 0 5px; color:var(--text-sub); font-size:0.9rem;">Select Content:</p>
                            <input type="text" id="cat-search" placeholder="Filter content..." onkeyup="renderCatContentList(this.value)" style="margin-bottom:10px;">
                            <div class="cat-builder-list" id="cat-content-list"></div>
                            <button class="btn btn-brand" style="width:100%; margin-top:20px;" onclick="saveCategory()">Save Category</button>
                        </div>
                    </div>
                    <div>
                        <h3>Active Categories</h3>
                        <div style="background:var(--bg-surface); border-radius:10px; border:1px solid var(--border); overflow:hidden; margin-top:10px;">
                            <table class="content-table" style="margin-top:0">
                                <thead><tr><th>Name</th><th>Count</th><th>Action</th></tr></thead>
                                <tbody id="active-cats-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-library" class="page-section hidden fade-in">
                <div class="page-header"><div class="page-title">Database</div></div>
                <table class="content-table">
                    <thead><tr><th>Type</th><th>Title</th><th>Year</th><th>Actions</th></tr></thead>
                    <tbody id="lib-list"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const USERNAME = "TouhidurTVCentre"; const PASSWORD = "2010991071";
        const DB_KEY = "teraDb";
        const CAT_KEY = "streamArcCats"; 

        let db = JSON.parse(localStorage.getItem(DB_KEY)) || [];
        let cats = JSON.parse(localStorage.getItem(CAT_KEY)) || [];
        let tempEpisodes = [];
        let editingId = null;

        function login() {
            if(document.getElementById('u-name').value === USERNAME && document.getElementById('u-pass').value === PASSWORD) {
                document.getElementById('auth-overlay').classList.add('hidden');
                document.getElementById('dashboard-ui').classList.remove('hidden');
                refreshLibrary(); refreshCats();
            } else { document.getElementById('login-error').style.display = 'block'; }
        }

        function switchTab(tab, el) {
            document.querySelectorAll('.page-section').forEach(d => d.classList.add('hidden'));
            document.getElementById('view-' + tab).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');
            
            if(tab === 'categories') { renderCatContentList(); refreshCats(); }
            if(tab === 'library') refreshLibrary();
            if((tab === 'add-movie' || tab === 'add-series') && !editingId) resetForms();
        }

        function addEpisodeToList() {
            const ep = {
                season: parseInt(document.getElementById('ep-season').value),
                ep: parseInt(document.getElementById('ep-num').value),
                title: document.getElementById('ep-title').value,
                url: document.getElementById('ep-url').value,
                duration: document.getElementById('ep-dur').value,
                thumb: document.getElementById('ep-thumb').value
            };
            if(!ep.url) return alert("URL Required");
            tempEpisodes.push(ep);
            renderEpPreview();
            document.getElementById('ep-num').value = ep.ep + 1;
        }

        function renderEpPreview() {
            const div = document.getElementById('ep-preview-list'); div.innerHTML = '';
            tempEpisodes.sort((a,b) => (a.season - b.season) || (a.ep - b.ep));
            tempEpisodes.forEach((ep, i) => {
                div.innerHTML += `<div class="ep-item"><span>S${ep.season}:E${ep.ep} - ${ep.title}</span><button class="btn-danger" style="padding:4px 8px; font-size:0.7rem;" onclick="removeEp(${i})">X</button></div>`;
            });
        }
        function removeEp(i) { tempEpisodes.splice(i, 1); renderEpPreview(); }

        function submitContent(type) {
            const prefix = type === 'movie' ? 'm' : 's';
            let item = {
                type: type,
                title: document.getElementById(`${prefix}-title`).value,
                year: document.getElementById(`${prefix}-year`).value,
                genre: document.getElementById(`${prefix}-genre`).value,
                poster: document.getElementById(`${prefix}-poster`).value,
                backdrop: document.getElementById(`${prefix}-backdrop`).value,
                description: document.getElementById(`${prefix}-desc`).value
            };

            if(type === 'movie') item.streamUrl = document.getElementById('m-url').value;
            else {
                if(tempEpisodes.length === 0) return alert("Add at least one episode");
                const sMap = {};
                tempEpisodes.forEach(ep => {
                    if(!sMap[ep.season]) sMap[ep.season] = {season: ep.season, episodes:[]};
                    sMap[ep.season].episodes.push(ep);
                });
                item.seasons = Object.values(sMap);
            }

            if(editingId) {
                item.id = editingId;
                const idx = db.findIndex(x => x.id === editingId);
                if(idx !== -1) db[idx] = item;
                alert("Content Updated!");
            } else {
                item.id = Date.now().toString();
                db.unshift(item);
                alert("Content Published!");
            }

            localStorage.setItem(DB_KEY, JSON.stringify(db));
            resetForms();
            switchTab('library');
        }

        function editItem(id) {
            const item = db.find(i => i.id === id);
            if(!item) return;
            editingId = id;

            if(item.type === 'movie') {
                switchTab('add-movie');
                document.getElementById('m-page-title').innerText = "Edit Movie";
                document.getElementById('m-submit-btn').innerText = "Update Movie";
                document.getElementById('m-title').value = item.title;
                document.getElementById('m-year').value = item.year;
                document.getElementById('m-genre').value = item.genre;
                document.getElementById('m-poster').value = item.poster;
                document.getElementById('m-backdrop').value = item.backdrop;
                document.getElementById('m-url').value = item.streamUrl;
                document.getElementById('m-desc').value = item.description;
            } else {
                switchTab('add-series');
                document.getElementById('s-page-title').innerText = "Edit Series";
                document.getElementById('s-submit-btn').innerText = "Update Series";
                document.getElementById('s-title').value = item.title;
                document.getElementById('s-year').value = item.year;
                document.getElementById('s-genre').value = item.genre;
                document.getElementById('s-poster').value = item.poster;
                document.getElementById('s-backdrop').value = item.backdrop;
                document.getElementById('s-desc').value = item.description;
                tempEpisodes = [];
                if(item.seasons) {
                    item.seasons.forEach(s => {
                        s.episodes.forEach(e => {
                            tempEpisodes.push({...e, season: s.season});
                        });
                    });
                }
                renderEpPreview();
            }
        }

        function deleteItem(id) {
            if(!confirm("Are you sure you want to delete this?")) return;
            db = db.filter(i => i.id !== id);
            localStorage.setItem(DB_KEY, JSON.stringify(db));
            refreshLibrary();
        }

        function refreshLibrary() {
            const list = document.getElementById('lib-list'); 
            list.innerHTML = '';
            db.forEach(i => {
                list.innerHTML += `<tr><td><span class="badge ${i.type}">${i.type}</span></td><td style="font-weight:600; color:white;">${i.title}</td><td>${i.year}</td><td style="display:flex; gap:10px;"><button class="btn-edit" style="padding:6px 10px;" onclick="editItem('${i.id}')"><i class="fas fa-edit"></i></button><button class="btn-danger" style="padding:6px 10px;" onclick="deleteItem('${i.id}')"><i class="fas fa-trash"></i></button></td></tr>`;
            });
        }

        function resetForms() {
            editingId = null;
            tempEpisodes = [];
            document.querySelectorAll('input, textarea').forEach(i => i.value='');
            document.getElementById('ep-preview-list').innerHTML = '';
            document.getElementById('ep-season').value = 1;
            document.getElementById('ep-num').value = 1;
            document.getElementById('m-page-title').innerText = "New Movie Asset";
            document.getElementById('m-submit-btn').innerText = "Publish Movie";
            document.getElementById('s-page-title').innerText = "New Series Asset";
            document.getElementById('s-submit-btn').innerText = "Publish Series";
        }

        function renderCatContentList(filter = "") {
            const container = document.getElementById('cat-content-list');
            container.innerHTML = '';
            db.forEach(item => {
                if(item.title.toLowerCase().includes(filter.toLowerCase())) {
                    container.innerHTML += `<div class="cat-item-row"><input type="checkbox" class="cat-checkbox" value="${item.id}"><img src="${item.poster}" style="width:30px; height:45px; object-fit:cover; margin-right:10px;"><div><div style="font-weight:600; font-size:0.9rem;">${item.title}</div><div style="font-size:0.75rem; color:gray;">${item.type}</div></div></div>`;
                }
            });
        }

        function saveCategory() {
            const name = document.getElementById('cat-name').value;
            const checks = document.querySelectorAll('.cat-checkbox:checked');
            if(!name || checks.length === 0) return alert("Name and Content required");
            const ids = Array.from(checks).map(c => c.value);
            cats.push({ id: Date.now().toString(), name: name, items: ids });
            localStorage.setItem(CAT_KEY, JSON.stringify(cats));
            document.getElementById('cat-name').value = '';
            renderCatContentList(); refreshCats();
            alert("Category Added!");
        }

        function refreshCats() {
            const body = document.getElementById('active-cats-body'); body.innerHTML = '';
            cats.forEach((c, i) => {
                body.innerHTML += `<tr><td style="color:white;">${c.name}</td><td>${c.items.length}</td><td><button class="btn-danger" onclick="deleteCat(${i})">X</button></td></tr>`;
            });
        }
        function deleteCat(i) { cats.splice(i, 1); localStorage.setItem(CAT_KEY, JSON.stringify(cats)); refreshCats(); }

    </script>
</body>
</html>